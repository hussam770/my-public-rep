<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>

    <script type="text/javascript">
        var startCalls=false;
        $(document).ready(function (){
            clickButton();
            startCalls=true;     
            
        })                                                                                                                                                                                                                                                                                                                                                                              
        function clickButton(){
            document.getElementById('testForm:btn_test').click();
        }
        function clickCounterButton(){
            
            document.getElementById('testForm:counterActivator').click();
        }
    </script>
    
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <h:form id="testForm">


    <h:commandButton id="btn_test" value="Test"
                     actionListener="#{testBean.initiateEventTimer}"
                     style="display: none">
        <f:ajax execute="btn_test" render="result_panelGroup"/>
    </h:commandButton>
        <h:commandButton id="counterActivator" value="Test"
                     actionListener="#{testBean.counterUpdateEvent}"
                     style="display: none">
        <f:ajax execute="counterActivator" render="result_panelGroup"/>

    </h:commandButton>
    <h:panelGroup id="result_panelGroup">
        <h:panelGroup id="inProgressGroup" rendered="#{!testBean.isCompleted}">
            Timer : #{testBean.counter} , this is good .....
            
            <script type="text/javascript">
                
                if(startCalls){
                   
                    setTimeout('clickButton()',1000);                
                }
            </script>
            
            <img src="ajax-loader.gif"></img>
        </h:panelGroup>
        <h:panelGroup id="completed" rendered="#{testBean.isCompleted}">
            the request successfully processed 
        </h:panelGroup>
    </h:panelGroup>
            </h:form>
    </h:body>
</html>

